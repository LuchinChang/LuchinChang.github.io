<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> ReLyMe | Lu-Chin Chang </title> <meta name="author" content="Lu-Chin Chang"> <meta name="description" content="A method that incorporates music theory into data-driven music generation models"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,700|Montserrat:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/site_icon.png?8b7ccf3154e9183937d6b9f11517cf47"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://luchinchang.github.io/projects/ReLyMe/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "ReLyMe",
            "description": "A method that incorporates music theory into data-driven music generation models",
            "published": "April 09, 2025",
            "authors": [
              
              {
                "author": "LC Chang",
                "authorURL": "https://luchinchang.github.io/",
                "affiliations": [
                  {
                    "name": "Zhejiang University",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Lu-Chin Chang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>ReLyMe</h1> <p>A method that incorporates music theory into data-driven music generation models</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#introduction">Introduction</a> </div> <div> <a href="#method">Method</a> </div> <div> <a href="#"></a> </div> <ul> <li> <a href="#tone">Tone</a> </li> <li> <a href="#rhythm">Rhythm</a> </li> <li> <a href="#structure">Structure</a> </li> </ul> <div> <a href="#experiments-and-results">Experiments and Results</a> </div> <div> <a href="#demo">Demo</a> </div> <div> <a href="#acknowledgments">Acknowledgments</a> </div> </nav> </d-contents> <p>Authors of the <a href="https://arxiv.org/pdf/2207.05688.pdf" rel="external nofollow noopener" target="_blank">paper</a>: Zhang, Chen and Chang, Luchin and Wu, Songruoyao and Tan, Xu and Qin, Tao and Liu, Tie-Yan and Zhang, Kejun</p> <h2 id="introduction">Introduction</h2> <p>Lyric-to-melody (L2M) generation, which generates melody according to given lyrics, is one of the most important automatic music composition tasks. With the rapid development of deep learning, previous works address this task with end-to-end neural network models. However, deep learning models cannot well capture the strict but subtle relationships between lyrics and melodies, which compromises the harmony between lyrics and generated melodies. In this paper, we propose ReLyMe, a method that incorporates <u>Re</u>lationships between <u>Ly</u>rics and <u>Me</u>lodies from music theory to ensure the harmony between lyrics and melodies.</p> <p>In summary, the main contributions of this work are as follows:</p> <ul> <li>We formulate the relationships between lyrics and melodies from three aspects (tone, rhythm, and structure) based on the music theory summarized by musicians.</li> <li>We propose ReLyMe, a method that exploits lyric-melody relationships during the decoding process of neural lyricto-melody generation systems to ensure harmony between generated melodies and corresponding lyrics.</li> <li>We conduct experiments on both English and Chinese song datasets and evaluate the generated melodies with objective and subjective evaluation. The results demonstrate the effectiveness of ReLyMe in guaranteeing the harmony between lyrics and melodies and show the significance of incorporating lyric-melody relationships into lyric-to-melody generation.</li> </ul> <h2 id="method">Method</h2> <p>There are two main parts of this work, which are quantitatizing the relationships between lyrics and melodies from music theory and proposing ReLyMe, which incorporates them into neural lyric-to-melody generation systems. ReLyMe takes effect upon current neural lyric-to-melody generation systems by incorporating relationships between lyrics and melodies.</p> <p>Considering that the generation process of most current neural network lyric-to-melody generation systems is auto-regressive, ReLyMe involves lyric-melody relationships into neural network models at each decoding step. Specifically, during inference, ReLyMe adjusts the probabilities of each decoding step to influence the current generated token, and further to affect the subsequent tokens.</p> <p>Denote the training lyric-melody pair as \(\{(\bf{x}, \bf{y}) \in (\bf{\mathcal{X}}, \bf{\mathcal{Y}})\}\). The original score function of beam search in generation system at \(i^{th}\) decoding step is:</p> <p>\begin{equation} s_i = logP(y_i|y_{0:i-1}, x). \end{equation}</p> <p>At each decoding step, the constrained decoding mechanism adds the reward \(R_{cons}\) directly to current score. \(R_{cons}(y_{0:i}, x)\) denotes the total reward at \(i^{th}\) decoding step under the musical constraints, which consists of three parts:</p> <ol> <li>the tone reward \(R_t(y_{0:i}, x)\)</li> <li>the rhythm reward \(R_r(y_{0:i}, x)\)</li> <li>the structure reward \(R_s(y_{0:i}, x)\)</li> </ol> <p>Thus, the score function in constrained decoding mechanism can be described as:</p> <p>\begin{equation} s_i’ = logP(y_i|y_{0:i-1}, x) + R_{cons}(y_{0:i}, x). \end{equation}</p> <p>Then \(s_i'\) is used in beam search as the new score function.</p> <p>We define the above three rewards based on the relationships between lyrics and melodies. The lyric-melody relationships mean the combining relationships between the rules of lyrics and the rules of the melodies within the scope of unified content, which control the interplay between the lyrics and melodies.</p> <figure> <picture> <img src="/assets/img/ReLyMe/case.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 1: This is the music sheet of a Mandarin song “Rainbow” by Jay Chou. The colorful boxes illustrate the lyric-melody relationships we formulate.</figcaption> </figure> <p>Below, the three aspects of relationships between lyrics and melodies are discussed. For more implication details, please refer to the <a href="https://arxiv.org/pdf/2207.05688.pdf" rel="external nofollow noopener" target="_blank">paper</a> and the <a href="https://github.com/microsoft/muzic/tree/main/relyme" rel="external nofollow noopener" target="_blank">code repo</a>.</p> <h3 id="tone">Tone</h3> <p>When the lyrics are sung with given melodies, the pitches of the lyrics are determined by the melodies instead of the intrinsic tone or stress. Aligning the pitch of the melody with the original pitch of the lyrics is essential for reducing semantic misunderstandings when performing songs. In order to align the melodies with the lyrics at the tonal level, we consider the following three granularities and define the corresponding rewards respectively.</p> <h4>Pitch Shape of a Single Tone.</h4> <p>For each syllable in lyrics, when it corresponds to more than one notes in the melody, the predefined shape of the tone should coincide with the pitch flow of the corresponding note group. Take Mandarin as an example, which contains four main tones (high level tone, rising tone, falling-rising tone, falling tone, denoted as tone1, tone2, tone3, and tone4) and a light tone (unstressed syllable pronounced without its original pitch in Chinese pronunciation, denoted tone5).</p> <figure> <picture> <img src="/assets/img/ReLyMe/pitch_shape.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 2: The pitch shape of four main tones in Mandarin.</figcaption> </figure> <h4>Pitch Transition between Adjacent Tones.</h4> <p>For a pair of adjacent syllables within the same sentence, the pitch flow of the corresponding adjacent notes needs to be in line with the pitch transition between tones, otherwise may lead to semantic misunderstanding like the figure below. According to the practice in natural speech, we measure the degree of harmony (excellent, good, fair, poor) for the pitch difference between neighboring notes given each adjacent tone pair.</p> <figure> <picture> <img src="/assets/img/ReLyMe/pitch_shape_bad_case.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 3: A bad case that breaks pitch transition principle. The "deng1 ta3" of the lyrics means "lighthouse", but it sounds like "deng3 ta1" meaning "waiting for him".</figcaption> </figure> <h4>Pitch Contour of a Whole Sentence.</h4> <p>Lyrics, as a form of text, have their inherent intonation for each sentence to express different emotions and meanings. The pitch contour of a whole sentence depends on the corresponding melody when performing a song, so the pitch direction of the melody needs to be matched to the inherent intonation of the sentence to ensure that the correct meaning is conveyed. For example, an interrogative tends to align with a rising melody (see the orange box of Figure 1).</p> <h3 id="rhythm">Rhythm</h3> <p>We consider the rhythmic relationship in two dimensions: 1) intensity at a certain moment, reflected in strong and weak positions; 2) temporal alignment, reflected in pause positions.</p> <h4>Strong/Weak Positions.</h4> <p>Both melodies and lyrics have the “strong” and “weak” elements, and the movement marked by the regulated succession of these elements is described as rhythm. A songwriter tends to align downbeats or accents with stressed syllables or important words. Aligning the rhythm of melody and lyrics helps convey meaning, express empathy and render emotion. The strong and weak positions in melody lines could be determined by multiple factors: pitch, duration, syncopation, meter, and so on. During automatic melody generation, for simplicity, the strong and weak beats can be derived from the predefined time signature. In lyrics, on the other hand, the strong and weak positions are mainly influenced by oral speaking habits, specific semantics, intent of speakers, and expressed emotions. For example, in spoken language, the auxiliary words tend to be pronounced lightly, while the keywords in the lyrics are often regarded as accents, which are pronounced louder to attract the attention of listeners and emphasize the elements. The strong and weak positions of melodies are aligned with those of lyrics to ensure harmony of performance and correct meaning.</p> <figure> <picture> <img src="/assets/img/ReLyMe/strong_weak.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 4: A bad case that assigns an auxiliary word to downbeat. The question auxiliary “ma” is heard as “ma”, which means mother.</figcaption> </figure> <h4>Pause Positions.</h4> <p>Pauses in speech divide the entire sentence into several parts with separate meanings (called prosodic phrases) to help the listener understand. Sentences with the same content but different pause positions can have completely different meanings, and the division of prosodic phrases that defies common sense can lead to confusion for listeners. In melody, the pauses are caused by either REST notes or long notes and split the melody into musical phrases, which make complete musical sense when heard on their own. When the lyrics are sung with given melodies, the pause positions are no longer influenced by the spoken idiom but are controlled by the pauses in the melody. A phenomenon called “broken phrases” occurs if syllables of the same prosodic phrase are assigned to different musical phrases. This phenomenon impairs the harmony between the melody and the lyrics and makes the lyrics hard to understand for listeners.</p> <figure> <picture> <img src="/assets/img/ReLyMe/pause_position.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 5: A bad case that breaks the principle of pause positions. There is a pause caused by long notes inside a word (red arrow), while an appropriate pause should be at the blue arrow. This mismatch spoils the coherence of the song.</figcaption> </figure> <h3 id="structure">Structure</h3> <p>At the full song level, the structure of lyrics and melody are constrained and influenced by each other. In music, form refers to the structure of a musical composition or performance, including repetition, transition and development. To better convey emotion and show artistry, lyrics and melodies which belong to the same musical form would share the same characteristics like rhyme (in lyrics) or motives (in melodies). Specifically, in lyric-to-melody generation, the melody segments that correspond to the lyrics of the same structure tend to have similar pitch flows.</p> <figure> <picture> <img src="/assets/img/ReLyMe/structure.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="case" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Figure 6: An example that shows the structure relationships between lyrics and melodies. The third sentence repeats the first sentence (see blue lines), and the fourth sentence repeats the second sentence (see green lines).</figcaption> </figure> <h2 id="experiments-and-results">Experiments and Results</h2> <p>In this work, we apply ReLyMe to SongMass and TeleMelody, two state-of-the-art systems in end-to-end and multi-stage L2M generation systems respectively. For the main experiments, we compare the original version of these two systems with the systems equipped with ReLyMe in Chinese and English. The results are evaluated with the introduced subjective and objective evaluation metrics which are give below.</p> <figure> <picture> <img src="/assets/img/ReLyMe/obj_result.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Table 1: Objective Evaluation</figcaption> </figure> <figure> <picture> <img src="/assets/img/ReLyMe/sub_result.png" class="img-fluid rounded" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> <figcaption class="caption">Table 2: Subjective Evaluation</figcaption> </figure> <p>We also perform method analysis discussing:</p> <ol> <li>Relationships of different aspects (tone, rhythm, structure).</li> <li>How strong should the constraints given by the relationships be.</li> <li>Different stages of incorporating the relationships (during training, while decoding, after decoding).</li> </ol> <p>Please refer to the <a href="https://arxiv.org/pdf/2207.05688.pdf" rel="external nofollow noopener" target="_blank">paper</a> for more details.</p> <h2 id="demo">Demo</h2> <figure> <iframe src="" class="rounded" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="" width="auto" height="auto"></iframe> <figcaption class="caption">The melody generated with ReLyMe (in TeleMelody) given the lyric of “Qing Hua Ci” by Jay Chou.</figcaption> </figure> <h2 id="acknowledgments">Acknowledgments</h2> <p>This work was done while I was a research assistant at NextLab, Zhejiang University in 2022, and it is part of the Microsoft <a href="https://github.com/microsoft/muzic" rel="external nofollow noopener" target="_blank">Muzic</a> open source library.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Lu-Chin Chang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Last updated: April 09, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>